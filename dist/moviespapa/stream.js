"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getStream=void 0;const getStream=function({link:link,providerContext:providerContext}){const{axios:axios,cheerio:cheerio}=providerContext,streams=[],commonHeaders={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/118.0.0.0 Safari/537.36",Referer:link,Origin:new URL(link).origin};return axios.get(link,{headers:commonHeaders}).then(res=>{const csrfInput=cheerio.load(res.data)("input[name^='_csrf_token']");if(csrfInput.length>0){const postBody=`${csrfInput.attr("name")}=${csrfInput.attr("value")}`;return axios.post(link,postBody,{headers:{...commonHeaders,"Content-Type":"application/x-www-form-urlencoded"}}).then(postRes=>postRes.data)}return res.data}).then(html=>{const $=cheerio.load(html);let extractedLinks=$("div.view-well a").map((_,el)=>$(el).attr("href")).get().filter(l=>l&&l.startsWith("http"));if(0===extractedLinks.length){const regex=/href=["'](https?:\/\/[^"']+)["']/g;extractedLinks=[...html.matchAll(regex)].map(m=>m[1])}const tasks=extractedLinks.map(url=>{var _a;if(url.includes("luluvid")||url.includes("lulustream"))return axios.get(url,{headers:commonHeaders}).then(luluRes=>{const match=luluRes.data.match(/file:\s*["']([^"']+\.m3u8[^"']*)["']/);match&&match[1]?streams.push({server:"Luluvid",link:match[1],type:"m3u8",headers:{Referer:url,Origin:new URL(url).origin,"User-Agent":commonHeaders["User-Agent"]}}):streams.push({server:"Luluvid",link:url,type:"mp4"})}).catch(err=>{});if(url.includes("strmup.to")||url.includes("strmupcdn")){const filecode=null===(_a=url.split("/").pop())||void 0===_a?void 0:_a.replace(".html","");if(filecode){const apiUrl=`https://strmup.to/ajax/stream?filecode=${filecode}`;return axios.get(apiUrl,{headers:commonHeaders}).then(apiRes=>{var _a;const directUrl=null===(_a=apiRes.data)||void 0===_a?void 0:_a.streaming_url;directUrl&&streams.push({server:"Strmup",link:directUrl,type:"m3u8"})}).catch(()=>{})}}else if(url.includes("pixeldrain.com")){const direct=url.replace("/u/","/api/file/");streams.push({server:"Pixeldrain",link:direct,type:"mp4"})}return Promise.resolve()});return Promise.all(tasks).then(()=>streams)}).catch(err=>[])};exports.getStream=getStream;