"use strict";function decodeBase64(input){try{if("function"==typeof atob)return decodeURIComponent(Array.prototype.map.call(atob(input),c=>"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)).join(""))}catch(_a){}try{return Buffer.from(input,"base64").toString("utf-8")}catch(_b){return""}}function extractM3U8(text){const match=text.match(/https?:\/\/[^\s"'<>]+\.m3u8[^\s"'<>]*/);return match?match[0]:null}function extractVidmolyM3U8(text){const match=text.match(/https?:\/\/box-[^"'\\\s]+\/hls\/[^"'\\\s]+\/master\.m3u8/);return match?match[0]:null}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getStream=void 0;const getStream=async function({link:link,providerContext:providerContext}){var _a,_b;const{axios:axios,cheerio:cheerio,commonHeaders:commonHeaders}=providerContext;try{const res=await axios.get(link,{headers:commonHeaders}),$=cheerio.load(res.data||"");for(const el of $(".server-list a").toArray()){const a=$(el),encoded=a.attr("data-url")||"";if(!encoded)continue;const decoded=decodeBase64(encoded).trim();if(!decoded)continue;const serverName=a.text().trim()||"Unknown";try{const iframeRes=await axios.get(decoded,{headers:{...commonHeaders,referer:"https://vidmoly.net/",origin:"https://vidmoly.net"},maxRedirects:5}),body="string"==typeof iframeRes.data?iframeRes.data:JSON.stringify(iframeRes.data),vidmolyM3U8=extractVidmolyM3U8(body);if(vidmolyM3U8)return[{server:serverName,link:vidmolyM3U8,type:"m3u8"}];const m3u8=extractM3U8(body);if(m3u8)return[{server:serverName,link:m3u8,type:"m3u8"}];const vkMatch=body.match(/"hls"\s*:\s*"([^"]+\.m3u8[^"]*)"/);if(vkMatch)return[{server:serverName,link:vkMatch[1].replace(/\\\//g,"/"),type:"m3u8"}];const finalUrl=null===(_b=null===(_a=iframeRes.request)||void 0===_a?void 0:_a.res)||void 0===_b?void 0:_b.responseUrl;if(finalUrl&&finalUrl.endsWith(".mp4"))return[{server:serverName,link:finalUrl,type:"mp4"}]}catch(_c){continue}}return[]}catch(err){return[]}};exports.getStream=getStream;