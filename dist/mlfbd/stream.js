"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};function getStream(_a){return __awaiter(this,arguments,void 0,function*({link:link,type:type,signal:signal,providerContext:providerContext}){try{const{axios:axios,cheerio:cheerio,extractors:extractors}=providerContext,headers={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36"},streams=[];streams.push({server:"Insta-Debug: Version 2.3",link:"https://google.com",type:"mkv"});const res=yield axios.get(link,{headers:headers,signal:signal}),$=cheerio.load(res.data),pendingStreams=[];if($("#download .links_table table tr").each((_,el)=>{const anchor=$(el).find("a");if(anchor.length>0){const url=anchor.attr("href"),rowText=$(el).text().toLowerCase();let resolution="720p";rowText.includes("1080p")?resolution="1080p":rowText.includes("480p")?resolution="480p":(rowText.includes("2160p")||rowText.includes("4k"))&&(resolution="4k"),url&&pendingStreams.push((()=>__awaiter(this,void 0,void 0,function*(){var _a,_b,_c;try{const linkRes=yield axios.get(url,{headers:headers,maxRedirects:5,validateStatus:status=>status<400}),finalUrl=(null===(_a=linkRes.request)||void 0===_a?void 0:_a.responseURL)||(null===(_c=null===(_b=linkRes.request)||void 0===_b?void 0:_b.res)||void 0===_c?void 0:_c.responseUrl)||linkRes.headers.location||linkRes.config.url||url;if(finalUrl.includes("gdflix")||finalUrl.includes("drivebot"))if(extractors.gdFlixExtracter){const extracted=yield extractors.gdFlixExtracter(finalUrl,signal);extracted&&0!==extracted.length||streams.push({server:"ERR: Gdflix empty",link:finalUrl,type:"error"}),extracted.forEach(s=>{s.server=`Mlfbd ${resolution} - ${s.server}`,streams.push(s)})}else streams.push({server:"ERR: No gdFlixExtracter",link:finalUrl,type:"error"});else streams.push({server:"Mlfbd "+resolution,link:finalUrl,type:"mkv"})}catch(e){streams.push({server:`ERR: ${e.message}`,link:url,type:"error"})}}))())}}),yield Promise.all(pendingStreams),0===streams.length){streams.push({server:"DBG: No streams found",link:"error",type:"error"});const downloadSection=$("#download").length,tableSection=$(".links_table").length;streams.push({server:`DBG: Sel: #dl=${downloadSection} .tbl=${tableSection}`,link:"error",type:"error"})}return streams}catch(err){return[{server:`ERR: TopLevel ${err.message}`,link:"error",type:"error"}]}})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getStream=getStream;