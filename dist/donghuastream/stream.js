"use strict";function unPack(code){try{const regex=/return\s+p}\s*\(\s*(['"])((?:(?!\1).|\\\1)+)\1\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(['"])((?:(?!\5).|\\\5)+)\5\.split\(['"]\|['"]\)/,match=code.match(regex);if(!match)return"";let[_,quote1,p,aStr,cStr,quote2,kStr]=match;const a=parseInt(aStr);let c=parseInt(cStr),k=kStr.split("|");const e=n=>(n<a?"":e(Math.floor(n/a)))+((n%=a)>35?String.fromCharCode(n+29):n.toString(36));for(;c--;)if(k[c]){const pattern=new RegExp("\\b"+e(c)+"\\b","g");p=p.replace(pattern,k[c])}return p}catch(err){return""}}function decodeBase64(input){try{return decodeURIComponent(Array.prototype.map.call(atob(input),c=>"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)).join(""))}catch(_a){}try{return Buffer.from(input,"base64").toString("utf-8")}catch(_b){return""}}function buildStream(server,link,referer,subtitles=[]){return{server:server,link:link,type:link.includes(".m3u8")?"m3u8":"mp4",subtitles:subtitles,headers:referer?{Referer:referer,"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Origin:"https://play.streamplay.co.in","X-Requested-With":"XMLHttpRequest"}:void 0}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getStream=void 0;const getStream=async function({link:link,providerContext:providerContext}){const{axios:axios,cheerio:cheerio,commonHeaders:commonHeaders}=providerContext;try{const res=await axios.get(link,{headers:commonHeaders,timeout:8e3}),$=cheerio.load(res.data||""),tasks=[],handleOption=el=>{var _a;const b64=$(el).attr("value");if(!b64)return;const decoded=decodeBase64(b64);if(!decoded)return;const iframe=cheerio.load(decoded)("iframe").attr("src")||cheerio.load(decoded)('meta[itemprop="embedUrl"]').attr("content");if(!iframe)return;let iframeUrl=iframe.startsWith("http")?iframe:"https:"+iframe;const server=$(el).text().trim()||"Server";if(iframeUrl.includes("play.streamplay.co.in/embed/")){const task=axios.get(iframeUrl,{headers:{...commonHeaders,Referer:link}}).then(embedRes=>{const embedHtml=embedRes.data||"";let unpacked="";embedHtml.includes("eval(function(p,a,c,k,e,d)")&&(unpacked=unPack(embedHtml));let tokenMatch=unpacked.match(/kaken\s*=\s*['"]([^'"]+)['"]/);if(tokenMatch||(tokenMatch=embedHtml.match(/kaken\s*=\s*['"]([^'"]+)['"]/)),tokenMatch&&tokenMatch[1]){const apiUrl=`https://play.streamplay.co.in/api/?${tokenMatch[1]}`;return axios.get(apiUrl,{headers:{Referer:iframeUrl,"X-Requested-With":"XMLHttpRequest","User-Agent":commonHeaders["User-Agent"],Accept:"application/json",Origin:"https://play.streamplay.co.in"}}).then(apiRes=>{const data=apiRes.data,streams=[];if(data&&data.sources){(Array.isArray(data.sources)?data.sources:[data.sources]).forEach(source=>{if(source.file){let streamUrl=source.file;streamUrl.includes("master.txt")&&(streamUrl=streamUrl.replace("master.txt","master.m3u8")),streams.push(buildStream(server||"StreamPlay",streamUrl,iframeUrl))}})}return streams.length>0?streams:[buildStream(server,iframeUrl,link)]})}const fileMatch=unpacked.match(/file\s*:\s*['"]([^'"]+)['"]/);if(fileMatch&&fileMatch[1]){let fallbackUrl=fileMatch[1];return fallbackUrl.includes("master.txt")&&(fallbackUrl=fallbackUrl.replace("master.txt","master.m3u8")),[buildStream(server||"StreamPlay",fallbackUrl,iframeUrl)]}return[buildStream(server,iframeUrl,link)]}).catch(e=>[buildStream(server,iframeUrl,link)]);return void tasks.push(task)}if(iframeUrl.includes("dailymotion.com")){const dmId=(null===(_a=iframeUrl.match(/\/video\/([a-zA-Z0-9]+)/))||void 0===_a?void 0:_a[1])||new URL(iframeUrl).searchParams.get("video");if(dmId)return void tasks.push(axios.get(`https://www.dailymotion.com/player/metadata/video/${dmId}`,{headers:commonHeaders,timeout:8e3}).then(r=>{var _a,_b,_c,_d;const m3u8=null===(_d=null===(_c=null===(_b=null===(_a=r.data)||void 0===_a?void 0:_a.qualities)||void 0===_b?void 0:_b.auto)||void 0===_c?void 0:_c[0])||void 0===_d?void 0:_d.url;return m3u8?[buildStream(server||"Dailymotion",m3u8,"https://www.dailymotion.com/")]:[buildStream(server,iframeUrl,link)]}).catch(()=>[buildStream(server,iframeUrl,link)]))}tasks.push(Promise.resolve([buildStream(server,iframeUrl,link)]))};$("option[data-index]").each((_,el)=>handleOption(el)),$(".mobius option").each((_,el)=>handleOption(el));const results=(await Promise.allSettled(tasks)).flatMap(r=>"fulfilled"===r.status?r.value:[]),seen=new Set,unique=results.filter(s=>!seen.has(s.link)&&(seen.add(s.link),!0));return unique.sort((a,b)=>{const A=a.server.toLowerCase(),B=b.server.toLowerCase();return A.includes("dailymotion")||A.includes("m3u8")?-1:B.includes("dailymotion")||B.includes("m3u8")?1:A.includes("all sub")||A.includes("streamplay")?-1:B.includes("all sub")||B.includes("streamplay")?1:0}),unique}catch(e){return[]}};exports.getStream=getStream;