"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getSearchPosts=exports.getPosts=void 0;const getPosts=async function({filter:filter,page:page,signal:signal,providerContext:providerContext}){const{getBaseUrl:getBaseUrl}=providerContext;return posts({url:`${await getBaseUrl("drive")}${filter}page/${page}/`,signal:signal,providerContext:providerContext})};exports.getPosts=getPosts;const getSearchPosts=async function({searchQuery:searchQuery,page:page,signal:signal,providerContext:providerContext}){try{const{getBaseUrl:getBaseUrl}=providerContext,baseUrl=await getBaseUrl("drive"),url=`${baseUrl}/searchapi.php?q=${encodeURIComponent(searchQuery)}&page=${page}`,res=await fetch(url,{signal:signal}),json=await res.json(),posts=[];if(!(null==json?void 0:json.hits))return posts;for(const item of json.hits){const doc=item.document;(null==doc?void 0:doc.post_title)&&(null==doc?void 0:doc.permalink)&&(null==doc?void 0:doc.post_thumbnail)&&posts.push({title:doc.post_title.trim(),link:doc.permalink.startsWith("http")?doc.permalink:baseUrl+doc.permalink,image:doc.post_thumbnail})}return posts}catch(err){return[]}};async function posts({url:url,signal:signal,providerContext:providerContext}){try{const{cheerio:cheerio}=providerContext,res=await fetch(url,{signal:signal}),html=await res.text(),$=cheerio.load(html),catalog=[];return $(".poster-card").each((_,el)=>{const title=$(el).find(".poster-title").text(),link=$(el).parent().attr("href"),image=$(el).find(".poster-image img").attr("src");title&&link&&image&&catalog.push({title:title.replace("Download","").trim(),link:link,image:image})}),catalog}catch(err){return[]}}exports.getSearchPosts=getSearchPosts;