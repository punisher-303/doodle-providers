"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getStream=void 0;const ENDPOINT_URL="https://d3sgzbosmwirao.cloudfront.net/",API_URL="https://api.mxplayer.in/v1/web",getStream=async function({link:link,type:type,providerContext:providerContext}){var _a,_b,_c;const{axios:axios}=providerContext,streamLinks=[];let streamObj=null;if(link.startsWith("{"))try{streamObj=JSON.parse(link).stream}catch(e){}else if(link.startsWith("http")&&link.includes("mxplayer.in"))try{const idMatch=link.match(/movie\/([a-zA-Z0-9]+)/);if(idMatch&&idMatch[1]){const id=idMatch[1],apiUrl=`${API_URL}/detail/tab/movierecommended?type=movie&id=${id}`;streamObj=(null===(_c=null===(_b=null===(_a=(await axios.get(apiUrl,{headers:{Referer:"https://www.mxplayer.in/","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64)"}})).data)||void 0===_a?void 0:_a.items)||void 0===_b?void 0:_b[0])||void 0===_c?void 0:_c.stream)||null}}catch(e){}if(streamObj){const extract=(obj,label)=>{obj&&["high","base","main"].forEach(q=>{const url=obj[q];url&&streamLinks.push({server:`MX ${label.toUpperCase()} ${q}`,link:normalizeUrl(url),type:"hls"===label?"m3u8":"dash",headers:{Referer:"https://www.mxplayer.in/"}})})};streamObj.hls&&extract(streamObj.hls,"hls"),streamObj.dash&&extract(streamObj.dash,"dash"),streamObj.mxplay&&(streamObj.mxplay.hls&&extract(streamObj.mxplay.hls,"hls"),streamObj.mxplay.dash&&extract(streamObj.mxplay.dash,"dash")),streamObj.thirdParty&&(streamObj.thirdParty.hlsUrl&&streamLinks.push({server:"ThirdParty HLS",link:normalizeUrl(streamObj.thirdParty.hlsUrl),type:"m3u8"}),streamObj.thirdParty.dashUrl&&streamLinks.push({server:"ThirdParty DASH",link:normalizeUrl(streamObj.thirdParty.dashUrl),type:"dash"}))}return streamLinks};function normalizeUrl(url){return url?url.startsWith("http")?url:ENDPOINT_URL+url:""}exports.getStream=getStream;