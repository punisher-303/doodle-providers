"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getPosts=getPosts,exports.getSearchPosts=getSearchPosts;const MAIN_URL="https://www.mxplayer.in",API_URL="https://api.mxplayer.in/v1/web",IMAGE_URL="https://qqcdnpictest.mxplay.com/",defaultHeaders={Referer:`${MAIN_URL}/`,Origin:MAIN_URL,"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"};async function getUserID(axios){try{const cookies=(await axios.get(MAIN_URL,{headers:defaultHeaders})).headers["set-cookie"];if(cookies)for(const c of cookies)if(c.includes("UserID=")){const match=c.match(/UserID=([^;]+)/);return match?match[1]:""}return""}catch(e){return""}}const getEndParam=userId=>`&device-density=2&userid=${userId}&platform=com.mxplay.desktop&content-languages=hi,en&kids-mode-enabled=false`;async function getPosts({filter:filter,page:page=1,providerContext:providerContext}){var _a;const{axios:axios}=providerContext,userId=await getUserID(axios),endParam=getEndParam(userId),url=`${API_URL}/detail/browseItem?pageNum=${page}&pageSize=20&isCustomized=true&${filter||"browseLangFilterIds=hi&type=1"}${endParam}`;try{const res=await axios.get(url,{headers:defaultHeaders});return((null===(_a=res.data)||void 0===_a?void 0:_a.items)||[]).map(item=>mapItemToPost(item))}catch(err){return[]}}async function getSearchPosts({searchQuery:searchQuery,providerContext:providerContext}){var _a;const{axios:axios}=providerContext,userId=await getUserID(axios),endParam=getEndParam(userId),url=`${API_URL}/search/resultv2?query=${encodeURIComponent(searchQuery)}${endParam}`;try{const sections=(null===(_a=(await axios.post(url,{},{headers:defaultHeaders})).data)||void 0===_a?void 0:_a.sections)||[],posts=[];for(const section of sections){const items=section.items||[];for(const item of items)posts.push(mapItemToPost(item))}return posts}catch(err){return[]}}function mapItemToPost(item){var _a;let image="";if(item.imageInfo){const portrait=item.imageInfo.find(i=>"portrait_large"===i.type);image=portrait&&portrait.url?IMAGE_URL+portrait.url:(null===(_a=item.imageInfo[0])||void 0===_a?void 0:_a.url)?IMAGE_URL+item.imageInfo[0].url:""}return{title:item.title||"",image:image,link:item.shareUrl?`${MAIN_URL}${item.shareUrl}`:""}}