"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getStream=void 0;const BASE_URL="https://animedekho.app",headers={Accept:"*/*","Accept-Language":"en-US,en;q=0.9","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36","X-Requested-With":"XMLHttpRequest"},getStream=function({link:link,type:type,signal:signal,providerContext:providerContext}){const{axios:axios,cheerio:cheerio}=providerContext,streams=[];return axios.get(link,{headers:{...headers,Referer:link},signal:signal}).then(res=>{const idMatch=(cheerio.load(res.data)("body").attr("class")||"").match(/(?:term|postid)-(\d+)/),termId=idMatch?idMatch[1]:null;if(!termId)return[];const trType="movie"===type?1:2,promises=[];for(let i=0;i<=10;i++){const iframeUrl=`${BASE_URL}/?trdekho=${i}&trid=${termId}&trtype=${trType}`,p=axios.get(iframeUrl,{headers:headers,signal:signal}).then(iframeRes=>{const src=cheerio.load(iframeRes.data)("iframe").attr("src");if(src)if(src.indexOf("strmup.to")>-1){const codeMatch=src.match(/strmup\.to\/([a-zA-Z0-9]+)/),fileCode=codeMatch?codeMatch[1]:null;if(fileCode){const apiUrl=`https://strmup.to/ajax/stream?filecode=${fileCode}`;return axios.get(apiUrl,{headers:headers,signal:signal}).then(apiRes=>{const data=apiRes.data;data&&data.streaming_url&&streams.push({server:`StrmUp (Server ${i+1})`,link:data.streaming_url,type:"m3u8",headers:{Referer:"https://strmup.to/"}})}).catch(()=>{})}}else if(src.indexOf("vidcloud.upns.ink")>-1){const hashParts=src.split("#"),id=hashParts.length>1?hashParts[1]:null;if(id){const m3u8Url=`https://spuc.satoriwell.online/v4/lf/${id}/cf-master.${Math.floor(Date.now()/1e3)}.txt`;streams.push({server:`VidCloud (Server ${i+1})`,link:m3u8Url,type:"m3u8",headers:{Referer:"https://vidcloud.upns.ink/",Origin:"https://vidcloud.upns.ink","User-Agent":headers["User-Agent"],Accept:"*/*"}})}}else{if(src.indexOf("vidmoly.net")>-1)return axios.get(src,{headers:headers,signal:signal}).then(vmRes=>{const tokenMatch=vmRes.data.match(/\?g=([a-zA-Z0-9]+)/);let nextPromise=Promise.resolve(vmRes);if(tokenMatch){const token=tokenMatch[1];nextPromise=axios.get(src+"?g="+token,{headers:headers,signal:signal})}return nextPromise.then(finalRes=>{const fileMatch=finalRes.data.match(/file\s*:\s*"([^"]+)"/);fileMatch&&streams.push({server:`Vidmoly (Server ${i+1})`,link:fileMatch[1],type:"m3u8",headers:{Referer:"https://vidmoly.net/","User-Agent":headers["User-Agent"]}})})}).catch(()=>{});if(src.indexOf("blakiteapi.xyz")>-1){const parts=src.split("/embed/");if(parts.length>1){const idParts=parts[1].split("/");if(idParts.length>=2){const tmdbId=idParts[0],apiUrl=`https://blakiteapi.xyz/api/get.php?id=${idParts[1]}&tmdbId=${tmdbId}`;return axios.get(apiUrl,{headers:headers,signal:signal}).then(apiRes=>{const data=apiRes.data;if(data&&data.success&&data.data&&data.data.dataId){const videoUrl=`https://hugh.cdn.rumble.cloud/video/${data.data.dataId}.caa.mp4`;streams.push({server:`Blakite (Server ${i+1})`,link:videoUrl,type:"mp4",headers:{"User-Agent":headers["User-Agent"]}})}}).catch(()=>{})}}}else{if(src.indexOf("turbovidhls.com")>-1)return axios.get(src,{headers:headers,signal:signal}).then(res=>{const m3u8Match=res.data.match(/(https?:\/\/[^"']+\.m3u8)/);m3u8Match&&streams.push({server:`TurboVid (Server ${i+1})`,link:m3u8Match[1],type:"m3u8",headers:{Referer:"https://turbovidhls.com/","User-Agent":headers["User-Agent"]}})}).catch(()=>{});if(src.indexOf("/aaa/ad/vidsrc/")>-1)return axios.get(src,{headers:headers,signal:signal}).then(vRes=>{const $v=cheerio.load(vRes.data);$v("#sourceSelector option").each((_,el)=>{const vidUrl=$v(el).attr("value"),label=$v(el).attr("data-label")||`Option ${_+1}`;vidUrl&&streams.push({server:`VidSrc ${i+1} (${label})`,link:vidUrl,type:vidUrl.includes(".m3u8")?"m3u8":"mp4",headers:{"User-Agent":headers["User-Agent"]}})})}).catch(()=>{});if(src.indexOf("/aaa/pixel/")>-1){const slugMatch=src.match(/slug=([a-zA-Z0-9]+)/),slug=slugMatch?slugMatch[1]:null;if(slug){const directUrl=`https://pixeldrain.net/api/file/${slug}`;streams.push({server:`PixelDrain (Server ${i+1})`,link:directUrl,type:"",headers:{"User-Agent":headers["User-Agent"]}})}}}}}).catch(()=>{});promises.push(p)}return Promise.all(promises).then(()=>streams)}).catch(err=>[])};exports.getStream=getStream;