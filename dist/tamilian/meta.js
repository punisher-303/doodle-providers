"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getMeta=void 0;const headers={Accept:"*/*","Accept-Language":"en-US,en;q=0.9","Cache-Control":"no-store","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"},BASE_URL="https://tamilian.io",PROXY_URL="https://api.allorigins.win/raw?url=",getMeta=async function({link:link,providerContext:providerContext}){var _a,_b,_c,_d;const{axios:axios,cheerio:cheerio}=providerContext,empty={title:"",synopsis:"",image:"",imdbId:"",type:"movie",linkList:[]};try{if(!link.startsWith("http"))return empty;const urlObj=new URL(link),ajaxPath=urlObj.searchParams.get("ajax");if(!ajaxPath)return empty;const movieId=null===(_a=ajaxPath.match(/\/(\d+)\//))||void 0===_a?void 0:_a[1];if(!movieId)return empty;const pageUrl=PROXY_URL+encodeURIComponent(urlObj.origin+urlObj.pathname),pageRes=await axios.get(pageUrl,{headers:headers}),$page=cheerio.load(pageRes.data||""),title=$page(".mvic-desc > h3").first().text().trim(),synopsis=$page(".mvic-desc .desc").first().text().trim(),posterMatch=($page(".thumb.mvic-thumb").attr("style")||"").match(/url\((['"]?)(.*?)\1\)/),image=(null==posterMatch?void 0:posterMatch[2])||"",serversApi=`${BASE_URL}/ajax/movie/episode/servers/${movieId}_1_full`,serversHtml=(null===(_b=(await axios.get(PROXY_URL+encodeURIComponent(serversApi),{headers:headers})).data)||void 0===_b?void 0:_b.html)||"";if(!serversHtml)return empty;const $servers=cheerio.load(serversHtml),directLinks=[],serverEls=$servers("a[data-id][data-name]").toArray();for(const el of serverEls){const serverId=$servers(el).attr("data-id"),serverName=$servers(el).attr("data-name");if(!serverId||!serverName)continue;const sourceApi=`${BASE_URL}/ajax/movie/episode/server/sources/${serverId}_${serverName}`;try{const sourceRes=await axios.get(PROXY_URL+encodeURIComponent(sourceApi),{headers:headers});(null===(_c=sourceRes.data)||void 0===_c?void 0:_c.status)&&(null===(_d=sourceRes.data)||void 0===_d?void 0:_d.src)&&directLinks.push({title:"Server",link:sourceRes.data.src,type:"movie",quality:"HD"})}catch(_e){continue}}return{title:title,synopsis:synopsis,image:image,imdbId:"",type:"movie",linkList:directLinks.length?[{title:"Watch",quality:"HD",directLinks:directLinks}]:[]}}catch(err){return empty}};exports.getMeta=getMeta;