"use strict";function decodeBase64(input){try{if("function"==typeof atob)return decodeURIComponent(Array.prototype.map.call(atob(input),c=>"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)).join(""))}catch(_a){}try{return Buffer.from(input,"base64").toString("utf-8")}catch(_b){return""}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getStream=void 0;const getStream=async function({link:link,providerContext:providerContext}){const{axios:axios,cheerio:cheerio,commonHeaders:commonHeaders}=providerContext,streams=[];try{link.match(/\.m3u8(\?.*)?$/)&&streams.push({server:"Direct Link",link:link,type:"m3u8"});const res=await axios.get(link,{headers:commonHeaders}),$=cheerio.load(res.data||"");for(const el of $("select.mirror option").toArray()){const encoded=$(el).attr("value")||"";if(!encoded)continue;const decoded=decodeBase64(encoded).trim();if(!decoded)continue;const serverName=$(el).text().trim()||"Unknown",iframeMatch=decoded.match(/src\s*=\s*["']([^"']+)["']/);if(iframeMatch){let src=iframeMatch[1];src.startsWith("//")&&(src="https:"+src);try{const m3u8Match=(await axios.get(src,{headers:commonHeaders})).data.match(/(https?:\/\/[^\s'"]+\.m3u8[^\s'"]*)/);m3u8Match&&streams.push({server:serverName,link:m3u8Match[1],type:"m3u8"})}catch(_a){continue}continue}const m3u8Match=decoded.match(/(https?:\/\/[^\s'"]+\.m3u8[^\s'"]*)/);m3u8Match&&streams.push({server:serverName,link:m3u8Match[1],type:"m3u8"})}return streams}catch(err){return[]}};exports.getStream=getStream;