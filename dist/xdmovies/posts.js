"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getSearchPosts=exports.getPosts=void 0;const MAIN_URL="https://xdmovies.site",TMDB_IMAGE_BASE="https://image.tmdb.org/t/p/original",commonHeaders={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36",Referer:MAIN_URL,"x-requested-with":"XMLHttpRequest"},getPosts=async function({filter:filter,page:page,providerContext:providerContext,signal:signal}){const{axios:axios,cheerio:cheerio}=providerContext,url="Homepage"===filter?`${MAIN_URL}/?page=${page}`:`${MAIN_URL}/${filter}&page=${page}`;try{const pageHeaders={...commonHeaders};delete pageHeaders["x-requested-with"];const res=await axios.get(url,{headers:pageHeaders,signal:signal}),$=cheerio.load(res.data),catalog=[];return $("div.container div.movie-grid a, .movie-grid .movie-card").each((_,el)=>{const element=$(el),title=element.find("h3").text().trim(),href=element.attr("href"),poster=element.find("img").attr("src");if(title&&href){const fullLink=href.startsWith("http")?href:`${MAIN_URL}${href.startsWith("/")?"":"/"}${href}`,fullPoster=(null==poster?void 0:poster.startsWith("http"))?poster:poster?`${MAIN_URL}${poster}`:"";catalog.push({title:title,link:fullLink,image:fullPoster})}}),catalog}catch(err){return[]}};exports.getPosts=getPosts;const getSearchPosts=async function({query:query,page:page,providerContext:providerContext,signal:signal}){var _a;const{axios:axios,cheerio:cheerio}=providerContext;if(page>1)return[];try{let token="7297skkihkajwnsgaklakshuwd";try{const tokenRes=await axios.get(`${MAIN_URL}/php/get_token.php`,{headers:commonHeaders,signal:signal});tokenRes.data&&"string"==typeof tokenRes.data?token=tokenRes.data.trim():(null===(_a=tokenRes.data)||void 0===_a?void 0:_a.token)&&(token=tokenRes.data.token)}catch(e){}const searchUrl=`${MAIN_URL}/php/search_api.php?query=${encodeURIComponent(query)}&fuzzy=true`,data=(await axios.get(searchUrl,{headers:{...commonHeaders,"x-auth-token":token},signal:signal})).data;if(Array.isArray(data))return data.map(item=>{const path=item.path||"",fullLink=path.startsWith("http")?path:`${MAIN_URL}${path.startsWith("/")?"":"/"}${path}`,posterSuffix=item.poster||"",fullPoster=posterSuffix?`${TMDB_IMAGE_BASE}${posterSuffix}`:"";return{title:item.title||"",link:fullLink,image:fullPoster}});if("string"==typeof data&&data.includes("movie-card")){const $=cheerio.load(data),catalog=[];return $(".movie-card").each((_,el)=>{const element=$(el),title=element.find("h3").text().trim(),href=element.attr("href"),poster=element.find("img").attr("src");if(title&&href){const fullLink=href.startsWith("http")?href:`${MAIN_URL}${href.startsWith("/")?"":"/"}${href}`;catalog.push({title:title,link:fullLink,image:poster||""})}}),catalog}return[]}catch(err){return[]}};exports.getSearchPosts=getSearchPosts;