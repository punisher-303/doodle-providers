"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getPosts=getPosts,exports.getSearchPosts=getSearchPosts;const BASE_URL="https://coflix.si",API_URL=`${BASE_URL}/wp-json/apiflix/v1`;async function getPosts({filter:filter="movies",page:page=1,signal:signal,providerContext:providerContext}){return fetchPosts({type:filter,page:page,signal:signal,providerContext:providerContext})}async function getSearchPosts({searchQuery:searchQuery,signal:signal,providerContext:providerContext}){const{axios:axios}=providerContext,url=`${BASE_URL}/suggest.php?query=${encodeURIComponent(searchQuery.trim())}`;try{const res=await axios.get(url,{signal:signal});return(res.data||[]).map(item=>({title:item.title,link:item.url.startsWith("http")?item.url:new URL(item.url,BASE_URL).href,image:resolveImage(item.image)}))}catch(_a){return[]}}async function fetchPosts({type:type,page:page,signal:signal,providerContext:providerContext}){var _a;const{axios:axios}=providerContext,url=`${API_URL}/options/?years=&post_type=${type}&genres=&page=${page}&sort=1`;try{const res=await axios.get(url,{signal:signal});return((null===(_a=res.data)||void 0===_a?void 0:_a.results)||[]).map(item=>({title:item.name,link:item.url.startsWith("http")?item.url:new URL(item.url,BASE_URL).href,image:resolveImage(item.path)}))}catch(_b){return[]}}function resolveImage(html){if(!html)return"";const match=html.match(/src=["']([^"']+)["']/i);if(!match)return"";let src=match[1];return src.startsWith("//")&&(src="https:"+src),src.startsWith("http")||(src=new URL(src,BASE_URL).href),src}