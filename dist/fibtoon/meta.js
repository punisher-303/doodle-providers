"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getMeta=void 0;const headers={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Referer:"https://fibtoon.top/"},getMeta=async function({link:link,providerContext:providerContext}){var _a;const{getBaseUrl:getBaseUrl,axios:axios,cheerio:cheerio}=providerContext,baseUrl=await getBaseUrl("fibtoon"),response=await axios.get(link,{headers:headers}),$=cheerio.load(response.data),videoId=null===(_a=$("input#video-id").val())||void 0===_a?void 0:_a.toString(),rawTitle=$('meta[property="og:title"]').attr("content")||$("title").text().trim(),image=$('meta[property="og:image"]').attr("content")||"",synopsis=$('meta[property="og:description"]').attr("content")||"",cleanTitle=rawTitle.split(/\s*(?:\(\d{4}\)|s\d{1,2}e\d{1,3}|s\d{1,2}|season|episode|720p|1080p|web-dl|dual|hindi|english|bluray|cam|hdts|hdrip|\[)/i)[0].replace(/[-|:|â€“]$/,"").trim(),isSeries=/s(\d{1,2})e(\d{1,3})|s(\d{1,2})|e(\d{1,3})/i.test(rawTitle.toLowerCase()),result={title:cleanTitle,synopsis:synopsis,image:image,imdbId:"",type:isSeries?"series":"movie",linkList:[]};if(isSeries&&videoId){const epData=(await axios.get(`${baseUrl}/ajax/episodes.php?video_id=${videoId}`,{headers:headers})).data;if(epData&&Array.isArray(epData.episodes)){const seasons=new Set;epData.episodes.forEach(ep=>{const match=ep.title.match(/s(\d{1,2})/i);match&&seasons.add(parseInt(match[1]))}),Array.from(seasons).sort((a,b)=>a-b).forEach(s=>{result.linkList.push({title:`Season ${s}`,quality:"HD",episodesLink:`season:${s}:vd:${videoId}`})})}}else if(videoId){try{const resData=(await axios.get(`${baseUrl}/ajax/resolution_switcher.php?video_id=${videoId}`,{headers:headers})).data;[...resData.current||[],...resData.popup||[]].forEach(item=>{if(item.url){const fullLink=item.url.startsWith("http")?item.url:`${baseUrl}${item.url.startsWith("/")?"":"/"}${item.url}`;result.linkList.push({title:`Play ${item.res||"HD"}`,quality:item.res||"HD",episodesLink:fullLink.trim()})}})}catch(e){}if(0===result.linkList.length){const downloadOnclick=$("a.hidden-button.buttonDownloadnew").attr("onclick"),match=null==downloadOnclick?void 0:downloadOnclick.match(/url=(.*?)',/);if(null==match?void 0:match[1]){const rawUrl=match[1].trim(),fullLink=rawUrl.startsWith("http")?rawUrl:`${baseUrl}${rawUrl.startsWith("/")?"":"/"}${rawUrl}`;fullLink&&result.linkList.push({title:"Play Movie",quality:"Multi",episodesLink:fullLink})}}}return result};exports.getMeta=getMeta;