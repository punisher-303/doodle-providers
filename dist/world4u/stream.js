"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getStream=void 0;const getStream=({link:url,type:type,providerContext:providerContext})=>{const{axios:axios,cheerio:cheerio}=providerContext,headers={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8",Referer:url},streams=[];return url.includes("mediafire.com")?axios.get(url,{headers:headers}).then(res=>{const $=cheerio.load(res.data),directLink=$("#downloadButton").attr("href")||$(".download_link a.input").attr("href");return directLink&&directLink.startsWith("http")&&streams.push({server:"Mediafire-Direct",link:directLink,type:"mkv"}),streams}).catch(err=>streams):axios.get(url,{headers:headers}).then(function(res){const $=cheerio.load(res.data);let fastiUrl="";if($("a").each(function(_,el){const text=$(el).text(),href=$(el).attr("href");href&&(text.includes("G-Drive")||href.includes("fastilinks"))&&(fastiUrl=href)}),!fastiUrl)throw new Error("Fastilinks URL not found on initial page");return axios.get(fastiUrl,{headers:headers})}).then(function(res){const csrfInput=cheerio.load(res.data)('input[name^="_csrf_token"]'),csrfName=csrfInput.attr("name"),csrfVal=csrfInput.attr("value");if(!csrfName||!csrfVal)throw new Error("CSRF token not found");const form=new URLSearchParams;form.append(csrfName,csrfVal);const currentUrl=res.config.url;return axios.post(currentUrl,form.toString(),{headers:{...headers,"Content-Type":"application/x-www-form-urlencoded",Referer:currentUrl}})}).then(function(unlockRes){const $=cheerio.load(unlockRes.data),promises=[];return $("a").each(function(_,el){const href=$(el).attr("href");href&&(href.includes("mediafire.com")&&promises.push(axios.get(href,{headers:{...headers,Referer:href}}).then(mfRes=>{const $mf=cheerio.load(mfRes.data),finalLink=$mf("a#downloadButton").attr("href")||$mf(".download_link a.input").attr("href");finalLink&&finalLink.startsWith("http")&&streams.push({server:"Mediafire-Direct",link:finalLink,type:"mkv"})}).catch(()=>{})),href.includes("photolinx.beauty")&&promises.push(axios.get(href,{headers:{...headers,Referer:href}}).then(plRes=>{const $pl=cheerio.load(plRes.data);let finalLink=$pl("a#download_button").attr("href");if(!finalLink||finalLink.includes("YOUR_DOWNLOAD_LINK_HERE")){const match=$pl("script").text().match(/https?:\/\/[^"']+\.(mkv|mp4|zip|rar)/i);match&&(finalLink=match[0])}finalLink&&finalLink.startsWith("http")&&streams.push({server:"Photolinx-Direct",link:finalLink,type:"mkv"})}).catch(()=>{})),(href.includes("gdflix.dev")||href.includes("gdflix.org"))&&promises.push(axios.get(href,{headers:headers}).then(gdRes=>{const $gd=cheerio.load(gdRes.data);$gd("a").each((_,gEl)=>{const gHref=$gd(gEl).attr("href"),gText=$gd(gEl).text().toUpperCase();if(gHref&&(gText.includes("CLOUD DOWNLOAD")&&gText.includes("R2")&&streams.push({server:"Cloud-R2",link:gHref,type:"mkv"}),gText.includes("FSL V2")&&gText.includes("R2")&&streams.push({server:"FSL-V2-R2",link:gHref,type:"mkv"}),gHref.includes("pixeldrain.com")||gHref.includes("pixeldrain.dev"))){const fileId=gHref.split("/").pop();streams.push({server:"PixelDrain-Direct",link:`https://pixeldrain.dev/api/file/${fileId}`,type:"mkv"})}})}).catch(()=>{})))}),Promise.all(promises).then(()=>streams)}).catch(function(err){return streams})};exports.getStream=getStream;