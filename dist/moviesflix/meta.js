"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getMeta=void 0,exports.fetchEpisodesFromSelectedLink=fetchEpisodesFromSelectedLink;const headers={Referer:"https://google.com","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"};async function fetchEpisodesFromSelectedLink(url,providerContext){const{axios:axios,cheerio:cheerio}=providerContext,res=await axios.get(url,{headers:headers}),$=cheerio.load(res.data),episodes=[];return $("h4").each((_,h4)=>{const title=$(h4).text().trim();if(!title)return;const directLinks=[];$(h4).nextUntil("h4, hr").find("a[href]").each((_,a)=>{var _a;let href=null===(_a=$(a).attr("href"))||void 0===_a?void 0:_a.trim();if(!href)return;href.startsWith("http")||(href=new URL(href,url).href);$(a).text().toLowerCase().includes("m-cloud")&&directLinks.push({link:href,title:"M-Cloud [Resumable]",quality:"AUTO",type:"episode"})}),directLinks.length&&episodes.push({title:title,directLinks:directLinks})}),episodes}const isInformationalHeading=text=>{const t=text.toLowerCase();return t.includes("series info")||t.includes("language")||t.includes("released year")||t.includes("episode size")||t.includes("format")||t.includes("imdb rating")||t.includes("winding up")},getMeta=async function({link:link,providerContext:providerContext}){var _a;const{axios:axios,cheerio:cheerio}=providerContext;try{link.startsWith("http")||(link=new URL(link).href);const res=await axios.get(link,{headers:headers}),$=cheerio.load(res.data),content=$(".entry-content, .post-inner").length?$(".entry-content, .post-inner"):$("body"),title=$("h1.entry-title").text().trim()||$("meta[property='og:title']").attr("content")||"Unknown";let image=$(".poster img").attr("src")||$("meta[property='og:image']").attr("content")||"";image&&!image.startsWith("http")&&(image=new URL(image,link).href);const imdbLink=$("a[href*='imdb.com']").attr("href")||"",imdbId=imdbLink?"tt"+(null===(_a=imdbLink.split("/tt")[1])||void 0===_a?void 0:_a.split("/")[0]):"";let synopsis="";content.find("p").each((_,p)=>{const txt=$(p).text().trim();if(txt.length>40&&!txt.toLowerCase().includes("download"))return synopsis=txt,!1});const pageText=content.text(),type=/season\s*\d+|episode\s*\d+/i.test(pageText)?"series":"movie",extraInfo={};content.find("p").each((_,p)=>{var _a,_b,_c,_d,_e;const html=$(p).html()||"",txt=$(p).text();html.includes("Language")&&(extraInfo.language=null===(_a=txt.split(":")[1])||void 0===_a?void 0:_a.trim()),html.includes("Released Year")&&(extraInfo.year=null===(_b=txt.split(":")[1])||void 0===_b?void 0:_b.trim()),html.includes("Quality")&&(extraInfo.quality=null===(_c=txt.split(":")[1])||void 0===_c?void 0:_c.trim()),html.includes("Episode Size")&&(extraInfo.size=null===(_d=txt.split(":")[1])||void 0===_d?void 0:_d.trim()),html.includes("Format")&&(extraInfo.format=null===(_e=txt.split(":")[1])||void 0===_e?void 0:_e.trim())});const linkList=[],episodeList=[];if(content.find("h5").each((_,h5)=>{var _a;const h5El=$(h5),titleText=h5El.text().trim();if(!titleText||isInformationalHeading(titleText))return;const href=h5El.next("p").find("a").first().attr("href");if(href){const quality=(null===(_a=titleText.match(/\d{3,4}p/i))||void 0===_a?void 0:_a[0])||"HD";linkList.push({title:titleText,quality:quality,directLinks:[{title:"Download",link:href,quality:quality,type:"movie"}]})}}),"series"===type){content.find("h3").each((_,h3)=>{var _a;const h3Text=$(h3).text().trim();if(!h3Text||isInformationalHeading(h3Text))return;const quality=(null===(_a=h3Text.match(/\d+p/))||void 0===_a?void 0:_a[0])||"AUTO",episodesLink=$(h3).nextUntil("h3, hr").find("a").filter((_,a)=>$(a).text().toLowerCase().includes("m-cloud")).first().attr("href");episodesLink&&linkList.push({title:h3Text,quality:quality,episodesLink:episodesLink})});for(const season of linkList){if(!season.episodesLink)continue;const eps=await fetchEpisodesFromSelectedLink(season.episodesLink,providerContext);episodeList.push(...eps)}}return{title:title,synopsis:synopsis,image:image,imdbId:imdbId,type:type,tags:[],cast:[],rating:"",linkList:linkList,episodeList:episodeList,extraInfo:extraInfo}}catch(err){return{title:"",synopsis:"",image:"",imdbId:"",type:"movie",tags:[],cast:[],rating:"",linkList:[],episodeList:[],extraInfo:{}}}};exports.getMeta=getMeta;