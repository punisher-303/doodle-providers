"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getPosts=getPosts,exports.getSearchPosts=getSearchPosts;let currentApiBase="https://myavens18052002.xyz/nzapis",currentApiKey="553y845hfhdlfhjkl438943943839443943fdhdkfjfj9834lnfd98",authToken=null,authExpireTime=0;async function ensureConfig(axios){var _a,_b;if(!(authToken&&Date.now()<authExpireTime))try{const authData=(await axios.post("https://identitytoolkit.googleapis.com/v1/accounts:signUp?key=AIzaSyAC__yhrI4ExLcqWbZjsLN33_gVgyp6w3A",{},{headers:{"Content-Type":"application/json"}})).data;authToken=authData.idToken,authExpireTime=Date.now()+1e3*parseInt(authData.expiresIn||"3600");const fields=(await axios.get("https://firestore.googleapis.com/v1/projects/xon-app/databases/(default)/documents/settings/BvJwsNb0eaObbigSefkm",{headers:{Authorization:`Bearer ${authToken}`}})).data.fields;if((null===(_a=fields.api)||void 0===_a?void 0:_a.stringValue)&&(currentApiKey=fields.api.stringValue),null===(_b=fields.base)||void 0===_b?void 0:_b.stringValue){let newUrl=fields.base.stringValue.replace(/\/$/,"");newUrl.startsWith("http:")&&(newUrl=newUrl.replace("http:","https:")),currentApiBase=newUrl}}catch(err){currentApiBase.startsWith("http:")&&(currentApiBase=currentApiBase.replace("http:","https:"))}}const getHeaders=()=>{let host="myavens18052002.xyz";try{host=new URL(currentApiBase).hostname}catch(e){}return{api:currentApiKey,"Cache-Control":"no-cache",caller:"vion-official-app",Connection:"Keep-Alive",Host:host,"User-Agent":"okhttp/3.14.9"}},formatPosterUrl=url=>{if(!url)return"";return(url.startsWith("http")?url:`https://archive.org/download/${url}`).replace("http://","https://")};async function getPosts({page:page=1,filter:filter,providerContext:providerContext}){const{axios:axios}=providerContext;await ensureConfig(axios);const posts=[],start=20*(page-1),end=start+20;try{const headers=getHeaders();if("trending_shows"===filter){const res=await axios.get(`${currentApiBase}/nzgetshows.php`,{headers:headers});res.data.slice(start,end).forEach(show=>{posts.push({title:show.name,link:`show:${show.id}`,image:formatPosterUrl(show.cover||show.thumb)})})}else if("latest_episodes"===filter){const res=await axios.get(`${currentApiBase}/nzgetepisodes_v2.php?since=`,{headers:headers});res.data.episodes.slice(start,end).forEach(ep=>{posts.push({title:`${ep.name} (Ep ${ep.no})`,link:`episode:${ep.id}`,image:formatPosterUrl(ep.thumb)})})}else if("movies"===filter){const res=await axios.get(`${currentApiBase}/nzgetmovies.php`,{headers:headers});res.data.slice(start,end).forEach(movie=>{posts.push({title:movie.name,link:`movie:${movie.id}`,image:formatPosterUrl(movie.cover||movie.thumb)})})}}catch(err){}return posts}async function getSearchPosts({searchQuery:searchQuery,providerContext:providerContext}){const{axios:axios}=providerContext;await ensureConfig(axios);const posts=[],query=searchQuery.toLowerCase();try{const headers=getHeaders();(await axios.get(`${currentApiBase}/nzgetshows.php`,{headers:headers})).data.forEach(show=>{show.name.toLowerCase().includes(query)&&posts.push({title:show.name,link:`show:${show.id}`,image:formatPosterUrl(show.cover||show.thumb)})});(await axios.get(`${currentApiBase}/nzgetmovies.php`,{headers:headers})).data.forEach(movie=>{(movie.name.toLowerCase().includes(query)||movie.tags&&movie.tags.toLowerCase().includes(query))&&posts.push({title:movie.name,link:`movie:${movie.id}`,image:formatPosterUrl(movie.cover||movie.thumb)})})}catch(err){}return posts}