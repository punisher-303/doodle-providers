"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getMeta=getMeta;let currentApiBase="https://myavens18052002.xyz/nzapis",currentApiKey="553y845hfhdlfhjkl438943943839443943fdhdkfjfj9834lnfd98",authToken=null,authExpireTime=0;async function ensureConfig(axios){var _a,_b;if(!(authToken&&Date.now()<authExpireTime))try{const authData=(await axios.post("https://identitytoolkit.googleapis.com/v1/accounts:signUp?key=AIzaSyAC__yhrI4ExLcqWbZjsLN33_gVgyp6w3A",{},{headers:{"Content-Type":"application/json"}})).data;authToken=authData.idToken,authExpireTime=Date.now()+1e3*parseInt(authData.expiresIn||"3600");const fields=(await axios.get("https://firestore.googleapis.com/v1/projects/xon-app/databases/(default)/documents/settings/BvJwsNb0eaObbigSefkm",{headers:{Authorization:`Bearer ${authToken}`}})).data.fields;if((null===(_a=fields.api)||void 0===_a?void 0:_a.stringValue)&&(currentApiKey=fields.api.stringValue),null===(_b=fields.base)||void 0===_b?void 0:_b.stringValue){let newUrl=fields.base.stringValue.replace(/\/$/,"");newUrl.startsWith("http:")&&(newUrl=newUrl.replace("http:","https:")),currentApiBase=newUrl}}catch(err){currentApiBase.startsWith("http:")&&(currentApiBase=currentApiBase.replace("http:","https:"))}}const getHeaders=()=>{let host="myavens18052002.xyz";try{host=new URL(currentApiBase).hostname}catch(e){}return{api:currentApiKey,"Cache-Control":"no-cache",caller:"vion-official-app",Connection:"Keep-Alive",Host:host,"User-Agent":"okhttp/3.14.9"}},formatPosterUrl=url=>{if(!url)return"";return(url.startsWith("http")?url:`https://archive.org/download/${url}`).replace("http://","https://")};async function getMeta({link:link,providerContext:providerContext}){const{axios:axios}=providerContext;await ensureConfig(axios);const headers=getHeaders(),[type,idStr]=link.split(":");parseInt(idStr);try{const languages=(await axios.get(`${currentApiBase}/nzgetlanguages.php`,{headers:headers})).data,getLangName=langId=>{const lang=languages.find(l=>l.id==langId);return lang?lang.name:"Unknown"};if("show"===type){const show=(await axios.get(`${currentApiBase}/nzgetshows.php`,{headers:headers})).data.find(s=>s.id==idStr);if(!show)throw new Error("Show not found");const languageName=getLangName(show.language),synopsis=`${show.des||""}\n\nLanguage: ${languageName}`,seasonsRes=await axios.get(`${currentApiBase}/nzgetseasons.php`,{headers:headers}),seasonLinks=seasonsRes.data.filter(s=>s.show_id==idStr).sort((a,b)=>a.no-b.no).map(season=>({title:season.name||`Season ${season.no}`,episodesLink:`season:${season.id}`,directLinks:[]}));return{title:`${show.name} (${languageName})`,imdbId:"",synopsis:synopsis.trim(),image:formatPosterUrl(show.cover||show.thumb),type:"series",tags:[],linkList:seasonLinks}}if("movie"===type){const movie=(await axios.get(`${currentApiBase}/nzgetmovies.php`,{headers:headers})).data.find(m=>m.id==idStr);if(!movie)throw new Error("Movie not found");const languageName=getLangName(movie.language),synopsis=`${movie.des||""}\n\nLanguage: ${languageName}`,tags=movie.tags?movie.tags.split(",").map(t=>t.trim()):[];return{title:`${movie.name} (${languageName})`,imdbId:"",synopsis:synopsis.trim(),image:formatPosterUrl(movie.cover||movie.thumb),type:"movie",tags:tags,linkList:[{title:movie.name,episodesLink:"",directLinks:[{title:"Movie",link:`movie:${movie.id}`}]}]}}}catch(err){}return{title:"",imdbId:"",synopsis:"",image:"",type:"movie",tags:[],linkList:[]}}