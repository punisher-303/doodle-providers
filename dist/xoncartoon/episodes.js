"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getEpisodes=getEpisodes;let currentApiBase="https://myavens18052002.xyz/nzapis",currentApiKey="553y845hfhdlfhjkl438943943839443943fdhdkfjfj9834lnfd98",authToken=null,authExpireTime=0;async function ensureConfig(axios){var _a,_b;if(!(authToken&&Date.now()<authExpireTime))try{const authData=(await axios.post("https://identitytoolkit.googleapis.com/v1/accounts:signUp?key=AIzaSyAC__yhrI4ExLcqWbZjsLN33_gVgyp6w3A",{},{headers:{"Content-Type":"application/json"}})).data;authToken=authData.idToken,authExpireTime=Date.now()+1e3*parseInt(authData.expiresIn||"3600");const fields=(await axios.get("https://firestore.googleapis.com/v1/projects/xon-app/databases/(default)/documents/settings/BvJwsNb0eaObbigSefkm",{headers:{Authorization:`Bearer ${authToken}`}})).data.fields;if((null===(_a=fields.api)||void 0===_a?void 0:_a.stringValue)&&(currentApiKey=fields.api.stringValue),null===(_b=fields.base)||void 0===_b?void 0:_b.stringValue){let newUrl=fields.base.stringValue.replace(/\/$/,"");newUrl.startsWith("http:")&&(newUrl=newUrl.replace("http:","https:")),currentApiBase=newUrl}}catch(err){currentApiBase.startsWith("http:")&&(currentApiBase=currentApiBase.replace("http:","https:"))}}const getHeaders=()=>{let host="myavens18052002.xyz";try{host=new URL(currentApiBase).hostname}catch(e){}return{api:currentApiKey,"Cache-Control":"no-cache",caller:"vion-official-app",Connection:"Keep-Alive",Host:host,"User-Agent":"okhttp/3.14.9"}},formatPosterUrl=url=>{if(!url)return"";return(url.startsWith("http")?url:`https://archive.org/download/${url}`).replace("http://","https://")};async function getEpisodes({url:url,providerContext:providerContext}){const{axios:axios}=providerContext;await ensureConfig(axios);const headers=getHeaders(),[type,idStr]=url.split(":");if("season"!==type)return[];const episodes=[];try{const allEpisodes=(await axios.get(`${currentApiBase}/nzgetepisodes_v2.php?since=`,{headers:headers})).data.episodes;allEpisodes.filter(e=>e.season_id==idStr).forEach(ep=>{episodes.push({title:`E${ep.no} - ${ep.name}`,link:`episode:${ep.id}`})}),episodes.sort((a,b)=>{var _a,_b;return parseInt((null===(_a=a.title.match(/E(\d+)/))||void 0===_a?void 0:_a[1])||"0")-parseInt((null===(_b=b.title.match(/E(\d+)/))||void 0===_b?void 0:_b[1])||"0")})}catch(err){}return episodes}