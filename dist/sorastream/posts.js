"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getPosts=getPosts,exports.getSearchPosts=getSearchPosts;const CINEMETA_URL="https://v3-cinemeta.strem.io",AIO_META_URL="https://aiometadata.elfhosted.com/stremio/9197a4a9-2f5b-4911-845e-8704c520bdf7",KITSU_URL="https://anime-kitsu.strem.fun";function resolvePoster(url){return url?url.includes("metahub.space")?"https://wsrv.nl/?url="+url.replace("/small/","/large/").replace("/medium/","/large/"):url:""}function buildPost(item){var _a;const type=item.type||"movie",id=item.id,baseUrl="anime"===type||String(id).startsWith("kitsu")?KITSU_URL:CINEMETA_URL;return{title:(null===(_a=item.aliases)||void 0===_a?void 0:_a[0])||item.name||"",link:`${baseUrl}/meta/${type}/${id}.json`,image:resolvePoster(item.poster)}}async function getPosts({filter:filter="movie",page:page=1,signal:signal,providerContext:providerContext}){var _a;const{axios:axios}=providerContext,skip=50*(page-1),url="anime"===filter?`${KITSU_URL}/catalog/anime/kitsu-anime-trending/skip=${skip}.json`:`${AIO_META_URL}/catalog/${filter}/tvdb.trending/skip=${skip}.json`;try{return((null===(_a=(await axios.get(url,{signal:signal})).data)||void 0===_a?void 0:_a.metas)||[]).map(buildPost)}catch(_b){return[]}}async function getSearchPosts({searchQuery:searchQuery,signal:signal,providerContext:providerContext}){const{axios:axios}=providerContext,endpoints=[`${CINEMETA_URL}/catalog/movie/top/search=${encodeURIComponent(searchQuery)}.json`,`${CINEMETA_URL}/catalog/series/top/search=${encodeURIComponent(searchQuery)}.json`,`${KITSU_URL}/catalog/anime/kitsu-anime-airing/search=${encodeURIComponent(searchQuery)}.json`];try{const results=await Promise.all(endpoints.map(url=>axios.get(url,{signal:signal}).then(r=>{var _a;return(null===(_a=r.data)||void 0===_a?void 0:_a.metas)||[]}).catch(()=>[]))),merged=[],max=Math.max(...results.map(r=>r.length));for(let i=0;i<max;i++)for(const list of results)list[i]&&merged.push(buildPost(list[i]));return merged}catch(_a){return[]}}