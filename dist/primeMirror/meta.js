"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):(value=result.value,value instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getMeta=void 0;const hdbHeaders={Referer:"https://google.com","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"},getMeta=function(_a){return __awaiter(this,arguments,void 0,function*({link:link,providerContext:providerContext}){var _b;try{const{axios:axios,cheerio:cheerio}=providerContext;link.startsWith("http")||(link=new URL(link,"https://filmycab.media").href);const res=yield axios.get(link,{headers:hdbHeaders}),$=cheerio.load(res.data),title=$("h1.entry-title").first().text().trim()||(null===(_b=$("meta[property='og:title']").attr("content"))||void 0===_b?void 0:_b.replace(" - Filmycab","").trim())||$("title").text().trim()||"Unknown";let image=$(".poster img").attr("src")||$("meta[property='og:image']").attr("content")||$("meta[name='twitter:image']").attr("content")||"";image&&image.startsWith("http")||(image=new URL(image||"/placeholder.png",link).href);let synopsis="";$(".wp-content p, .entry-content p, .description, .synopsis").each((_,el)=>{const text=$(el).text().trim();if(text&&text.length>40&&!text.toLowerCase().includes("download"))return synopsis=text,!1}),synopsis||(synopsis=$("meta[property='og:description']").attr("content")||$("meta[name='description']").attr("content")||"");const tags=$(".sgeneros a, .genres a, .genre a").map((_,el)=>$(el).text().trim()).get()||[],cast=$(".cast .person a, .casting a, .actors a").map((_,el)=>$(el).text().trim()).get()||[];let rating=$(".imdb span[itemprop='ratingValue']").text().trim()||$(".ratingValue").text().trim()||$("meta[itemprop='ratingValue']").attr("content")||"";rating&&!rating.includes("/")&&(rating+="/10");const imdbLink=$(".imdb a[href*='imdb.com'], a[href*='imdb.com']").attr("href")||"",imdbId=imdbLink&&imdbLink.includes("/tt")?"tt"+imdbLink.split("/tt")[1].split("/")[0]:"",links=[],singleLink=$(".dlbtn a[href]").attr("href");if(singleLink)try{const subRes=yield axios.get(singleLink,{headers:hdbHeaders}),_$=cheerio.load(subRes.data);_$(".dlink.dl a[href]").each((_,a)=>{const href=(_$(a).attr("href")||"").trim(),text=_$(a).find(".dll").text().trim()||_$(a).text().trim();if(!href||!text)return;const qualityMatch=text.match(/\b(240p|360p|480p|720p|1080p|2160p|4k)\b/i),quality=qualityMatch?qualityMatch[0]:"AUTO";links.push({title:text,directLinks:[{link:href,title:text,quality:quality,type:"movie"}]})})}catch(err){}return{title:title,synopsis:synopsis,image:image,imdbId:imdbId,type:"movie",tags:tags,cast:cast,rating:rating,linkList:links}}catch(err){return{title:"",synopsis:"",image:"https://via.placeholder.com/300x450",imdbId:"",type:"movie",tags:[],cast:[],rating:"",linkList:[]}}})};exports.getMeta=getMeta;