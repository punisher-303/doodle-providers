"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getStream=getStream;let currentApiBase="https://myavens18052002.xyz/nzapis",currentApiKey="553y845hfhdlfhjkl438943943839443943fdhdkfjfj9834lnfd98",authToken=null,authExpireTime=0;async function ensureConfig(axios){var _a,_b;if(!(authToken&&Date.now()<authExpireTime))try{const authData=(await axios.post("https://identitytoolkit.googleapis.com/v1/accounts:signUp?key=AIzaSyAC__yhrI4ExLcqWbZjsLN33_gVgyp6w3A",{},{headers:{"Content-Type":"application/json"}})).data;authToken=authData.idToken,authExpireTime=Date.now()+1e3*parseInt(authData.expiresIn||"3600");const fields=(await axios.get("https://firestore.googleapis.com/v1/projects/xon-app/databases/(default)/documents/settings/BvJwsNb0eaObbigSefkm",{headers:{Authorization:`Bearer ${authToken}`}})).data.fields;if((null===(_a=fields.api)||void 0===_a?void 0:_a.stringValue)&&(currentApiKey=fields.api.stringValue),null===(_b=fields.base)||void 0===_b?void 0:_b.stringValue){let newUrl=fields.base.stringValue.replace(/\/$/,"");newUrl.startsWith("http:")&&(newUrl=newUrl.replace("http:","https:")),currentApiBase=newUrl}}catch(err){currentApiBase.startsWith("http:")&&(currentApiBase=currentApiBase.replace("http:","https:"))}}const getHeaders=()=>{let host="myavens18052002.xyz";try{host=new URL(currentApiBase).hostname}catch(e){}return{api:currentApiKey,"Cache-Control":"no-cache",caller:"vion-official-app",Connection:"Keep-Alive",Host:host,"User-Agent":"okhttp/3.14.9"}},formatVideoUrl=url=>{if(!url)return"";let finalUrl=url.startsWith("http")?url:`https://archive.org/download/${url}`;return finalUrl.startsWith("http:")&&(finalUrl=finalUrl.replace("http:","https:")),finalUrl.match(/\.mkv$/i)&&(finalUrl=finalUrl.replace(/\.mkv$/i,".mp4")),finalUrl};async function getStream({link:link,providerContext:providerContext}){const{axios:axios}=providerContext,streams=[];await ensureConfig(axios);const headers=getHeaders(),[type,idStr]=link.split(":");try{let item=null;if("episode"===type){item=(await axios.get(`${currentApiBase}/nzgetepisodes_v2.php?since=`,{headers:headers})).data.episodes.find(e=>e.id==idStr)}else if("movie"===type){item=(await axios.get(`${currentApiBase}/nzgetmovies.php`,{headers:headers})).data.find(m=>m.id==idStr)}if(!item)return[];item.basic&&streams.push({server:"Xon Basic (240p)",link:formatVideoUrl(item.basic),type:"mp4"}),item.sd&&streams.push({server:"Xon SD (480p)",link:formatVideoUrl(item.sd),type:"mp4"}),item.hd&&streams.push({server:"Xon HD (720p)",link:formatVideoUrl(item.hd),type:"mp4"}),item.fhd&&streams.push({server:"Xon FHD (1080p)",link:formatVideoUrl(item.fhd),type:"mp4"}),item.link&&streams.push({server:"External Embed",link:item.link,type:"m3u8"})}catch(err){}return streams}