"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getStream=getStream;const headers={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8","Cache-Control":"no-store","Accept-Language":"en-US,en;q=0.9","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"};async function getStream({link:link,type:type,signal:signal,providerContext:providerContext}){var _a;const{axios:axios,cheerio:cheerio,extractors:extractors}=providerContext,{hubcloudExtracter:hubcloudExtracter}=extractors;let streamLinks=[];try{if(link.includes("mdrive.lol/archives/")){const resolveUrl=`https://sadabefy.vercel.app/api/resolve-link?url=${encodeURIComponent(link)}`,data=(await axios.get(resolveUrl,{headers:headers,signal:signal})).data;if((null==data?void 0:data.success)&&(null===(_a=null==data?void 0:data.data)||void 0===_a?void 0:_a.linkData)){const foundLinks=[];data.data.linkData.forEach(section=>{section.links.forEach(l=>{l.url&&!l.url.includes("moviesdrives.cv")&&foundLinks.push(l.url)})});const priorityLink=foundLinks.find(l=>/hubcloud|gdflix/i.test(l))||foundLinks[0];priorityLink&&(link=priorityLink)}}if(/hubcloud/i.test(link))return await hubcloudExtracter(link,signal);if(/gdflix\.dev/i.test(link)){const fileIdMatch=link.match(/file\/([a-zA-Z0-9]+)/);fileIdMatch&&(link=`https://new13.gdflix.net/file/${fileIdMatch[1]}`)}const pageRes=await axios.get(link,{headers:headers,signal:signal}),$=cheerio.load(pageRes.data);$("a.btn.btn-outline-success").each((_,el)=>{const btn=$(el);if(btn.text().toLowerCase().includes("cloud download")){const cloudLink=btn.attr("href");cloudLink&&streamLinks.push({server:"Cloud",link:cloudLink,type:"mkv"})}});const finalizedStreams=[];for(const s of streamLinks)if(/hubcloud/i.test(s.link)){const extracted=await hubcloudExtracter(s.link,signal);finalizedStreams.push(...extracted)}else finalizedStreams.push(s);return finalizedStreams.length>0?finalizedStreams:streamLinks}catch(error){return[]}}