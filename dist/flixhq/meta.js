"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getMeta=void 0,exports.fetchEpisodesFromSelectedLink=fetchEpisodesFromSelectedLink;const headers={Referer:"https://google.com","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"};async function fetchEpisodesFromSelectedLink(url,providerContext){const{axios:axios,cheerio:cheerio}=providerContext;try{const res=await axios.get(url,{headers:headers}),$=cheerio.load(res.data),episodes=[];return $("h4").each((_,h4El)=>{const epTitle=$(h4El).text().trim();if(!epTitle)return;const directLinks=[];$(h4El).nextUntil("h4, hr").find("a[href]").each((_,linkEl)=>{let href=($(linkEl).attr("href")||"").trim();if(!href)return;href.startsWith("http")||(href=new URL(href,url).href);const btnText=$(linkEl).text().trim()||"Watch Episode";directLinks.push({link:href,title:btnText,quality:"AUTO",type:"episode"})}),directLinks.length>0&&episodes.push({title:epTitle,directLinks:directLinks})}),episodes}catch(err){return[]}}const getMeta=async function({link:link,providerContext:providerContext}){var _a,_b;const{axios:axios,cheerio:cheerio}=providerContext,emptyResult={title:"",synopsis:"",image:"",imdbId:"",type:"movie",linkList:[]};try{const res=await axios.get(link,{headers:headers}),$=cheerio.load(res.data),content=$(".entry-content, .post-inner").length?$(".entry-content, .post-inner"):$("body"),title=$("h1.entry-title").first().text().trim()||(null===(_a=$("meta[property='og:title']").attr("content"))||void 0===_a?void 0:_a.trim())||"Unknown",pageText=content.text(),isSeries=/Season\s*\d+/i.test(pageText)||/Episode\s*\d+/i.test(pageText),type=isSeries?"series":"movie";let image=$(".poster img").attr("src")||$("meta[property='og:image']").attr("content")||$("meta[name='twitter:image']").attr("content")||"";image&&!image.startsWith("http")&&(image=new URL(image,link).href);let synopsis="";$(".entry-content p").each((_,el)=>{const txt=$(el).text().trim();if(txt.length>40&&!txt.toLowerCase().includes("download"))return synopsis=txt,!1});const imdbLink=$("a[href*='imdb.com']").attr("href")||"",imdbId=imdbLink?"tt"+((null===(_b=imdbLink.split("/tt")[1])||void 0===_b?void 0:_b.split("/")[0])||""):"",links=[];return isSeries?content.find("h3").each((_,h3)=>{var _a;const h3Text=$(h3).text().trim(),qualityMatch=(null===(_a=h3Text.match(/\d+p/))||void 0===_a?void 0:_a[0])||"AUTO",href=$(h3).nextUntil("h3, hr").find("a").filter((_,a)=>/v-cloud|mega|gdrive|download|batch|zip|ep!|link/i.test($(a).text())).first().attr("href");href&&links.push({title:h3Text,quality:qualityMatch,episodesLink:href,directLinks:[]})}):content.find("h3, h5").each((_,heading)=>{var _a;const headingText=$(heading).text().trim(),qualityMatch=(null===(_a=headingText.match(/\d+p/))||void 0===_a?void 0:_a[0])||"AUTO",linkEl=$(heading).nextUntil("h3, h5, hr").find("a[href]").first(),href=linkEl.attr("href");if(href){let finalHref=href.trim();finalHref.startsWith("http")||(finalHref=new URL(finalHref,link).href);const btnText=linkEl.text().trim()||"Download Link";if(/imdb rating|winding up/i.test(btnText))return;links.push({title:headingText,quality:qualityMatch,episodesLink:"",directLinks:[{title:btnText,link:finalHref,quality:qualityMatch,type:"movie"}]})}}),{title:title,synopsis:synopsis,image:image,imdbId:imdbId,type:type,linkList:links}}catch(err){return emptyResult}};exports.getMeta=getMeta;