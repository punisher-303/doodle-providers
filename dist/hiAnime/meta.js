"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getMeta=void 0,exports.fetchEpisodesFromSelectedLink=fetchEpisodesFromSelectedLink;const headers={Referer:"https://google.com","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36"};async function fetchEpisodesFromSelectedLink(url,providerContext){const{axios:axios,cheerio:cheerio}=providerContext,res=await axios.get(url,{headers:headers}),$=cheerio.load(res.data),episodes=[];return $("h4").each((_,h4El)=>{const epTitle=$(h4El).text().trim();if(!epTitle)return;const directLinks=[];$(h4El).nextUntil("h4, hr").find("a[href]").each((_,linkEl)=>{let href=($(linkEl).attr("href")||"").trim();if(!href)return;href.startsWith("http")||(href=new URL(href,url).href);const btnText=$(linkEl).text().trim()||"Watch Episode";directLinks.push({link:href,title:btnText,quality:"AUTO",type:"episode"})}),directLinks.length>0&&episodes.push({title:epTitle,directLinks:directLinks})}),episodes}const getMeta=async function({link:link,providerContext:providerContext}){var _a,_b;const{axios:axios,cheerio:cheerio}=providerContext;link.startsWith("http")||(link=new URL(link,"https://vgmlinks.click").href);try{const res=await axios.get(link,{headers:headers}),$=cheerio.load(res.data),title=$("h1.entry-title").first().text().trim()||(null===(_a=$("meta[property='og:title']").attr("content"))||void 0===_a?void 0:_a.trim())||"Unknown";let image=$(".poster img").attr("src")||$("meta[property='og:image']").attr("content")||$("meta[name='twitter:image']").attr("content")||"";image&&!image.startsWith("http")&&(image=new URL(image,link).href);let synopsis="";$(".entry-content p").each((_,el)=>{const txt=$(el).text().trim();if(txt.length>40&&!txt.toLowerCase().includes("download"))return synopsis=txt,!1});const imdbLink=$("a[href*='imdb.com']").attr("href")||"",imdbId=imdbLink?"tt"+((null===(_b=imdbLink.split("/tt")[1])||void 0===_b?void 0:_b.split("/")[0])||""):"",tags=[];$(".entry-content p strong").each((_,el)=>{const txt=$(el).text().trim();txt.match(/drama|biography|action|thriller|romance|adventure|animation/i)&&tags.push(txt)});const extra={};$("p").each((_,el)=>{var _a,_b,_c,_d,_e,_f;const html=$(el).html()||"";html.includes("Series Name")&&(extra.name=null===(_a=$(el).text().split(":")[1])||void 0===_a?void 0:_a.trim()),html.includes("Language")&&(extra.language=null===(_b=$(el).text().split(":")[1])||void 0===_b?void 0:_b.trim()),html.includes("Released Year")&&(extra.year=null===(_c=$(el).text().split(":")[1])||void 0===_c?void 0:_c.trim()),html.includes("Quality")&&(extra.quality=null===(_d=$(el).text().split(":")[1])||void 0===_d?void 0:_d.trim()),html.includes("Episode Size")&&(extra.size=null===(_e=$(el).text().split(":")[1])||void 0===_e?void 0:_e.trim()),html.includes("Format")&&(extra.format=null===(_f=$(el).text().split(":")[1])||void 0===_f?void 0:_f.trim())});let links=[],episodeList=[];return $("h3").each((_,h3El)=>{const seasonText=$(h3El).text().trim();$(h3El).nextUntil("h3, hr").find("a[href]").each((_,aEl)=>{let href=($(aEl).attr("href")||"").trim();if(!href)return;href.startsWith("http")||(href=new URL(href,link).href);const btnText=$(aEl).text().trim()||"Link";btnText.toLowerCase().includes("imdb rating")||btnText.toLowerCase().includes("winding up")||links.push({title:`${seasonText} - ${btnText}`,directLinks:[{link:href,title:btnText,quality:"AUTO",type:"movie"}],episodesLink:href})})}),links=[...links.filter(l=>l.title.toLowerCase().includes("v-cloud")||l.title.toLowerCase().includes("source 2")),...links.filter(l=>!l.title.toLowerCase().includes("v-cloud")&&!l.title.toLowerCase().includes("source 2"))],{title:title,synopsis:synopsis,image:image,imdbId:imdbId,type:"series",tags:tags,cast:[],rating:$(".entry-meta .entry-date").text().trim()||"",linkList:links,extraInfo:extra,episodeList:episodeList}}catch(err){return{title:"",synopsis:"",image:"",imdbId:"",type:"movie",tags:[],cast:[],rating:"",linkList:[],extraInfo:{},episodeList:[]}}};exports.getMeta=getMeta;