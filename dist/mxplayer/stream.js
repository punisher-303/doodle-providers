"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getStream=void 0;const ENDPOINT_URL="https://d3sgzbosmwirao.cloudfront.net/",API_URL="https://api.mxplayer.in/v1/web",getStream=async function({link:link,type:type,providerContext:providerContext}){var _a;const{axios:axios}=providerContext,streamLinks=[];let streamObj=null;if(link.startsWith("{"))try{streamObj=JSON.parse(link).stream}catch(e){}else if(link.startsWith("http"))try{const idMatch=link.match(/-id-([a-zA-Z0-9]+)/);if(idMatch&&idMatch[1]){const id=idMatch[1],apiUrl=`${API_URL}/detail/video/${id}?${"&device-density=2&userid=&platform=com.mxplay.desktop&content-languages=hi,en&kids-mode-enabled=false"}`;streamObj=null===(_a=(await axios.get(apiUrl,{headers:{Referer:"https://www.mxplayer.in/"}})).data)||void 0===_a?void 0:_a.stream}}catch(e){}if(streamObj){const extract=(obj,label)=>{if(!obj)return;["high","base","main"].forEach(q=>{const url=obj[q];url&&streamLinks.push({server:`MX ${label} ${q}`,link:normalizeUrl(url),type:"hls"===label?"m3u8":"dash",headers:{Referer:"https://www.mxplayer.in/"}})})};streamObj.hls&&extract(streamObj.hls,"hls"),streamObj.dash&&extract(streamObj.dash,"dash"),streamObj.thirdParty&&(streamObj.thirdParty.hlsUrl&&streamLinks.push({server:"ThirdParty HLS",link:normalizeUrl(streamObj.thirdParty.hlsUrl),type:"m3u8"}),streamObj.thirdParty.dashUrl&&streamLinks.push({server:"ThirdParty DASH",link:normalizeUrl(streamObj.thirdParty.dashUrl),type:"dash"})),streamObj.mxplay&&(streamObj.mxplay.hls&&extract(streamObj.mxplay.hls,"hls"),streamObj.mxplay.dash&&extract(streamObj.mxplay.dash,"dash"))}return streamLinks};function normalizeUrl(url){return url?url.startsWith("http")?url:ENDPOINT_URL+url:""}exports.getStream=getStream;