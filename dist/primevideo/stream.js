"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getStream=void 0;const MAIN_URL="https://net20.cc",STREAM_URL="https://net51.cc",UA="Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Mobile Safari/537.36";async function getBypassCookie(axios){let attempt=0;for(;attempt<10;){try{const res=await axios.post(`${MAIN_URL}/tv/p.php`,null,{headers:{"User-Agent":UA,"X-Requested-With":"XMLHttpRequest"}});if(("string"==typeof res.data?res.data:JSON.stringify(res.data)).includes('"r":"n"')){const setCookie=res.headers["set-cookie"];if(Array.isArray(setCookie)){const hashCookie=setCookie.find(c=>c.includes("t_hash_t"));if(hashCookie){const match=hashCookie.match(/t_hash_t=([^;]+)/);return match?match[1]:""}}}}catch(error){}attempt++}return""}const getStream=async function({link:link,providerContext:providerContext}){const{axios:axios}=providerContext,unix=Math.floor(Date.now()/1e3),[id,title=""]=link.split("|");try{const tHashT=await getBypassCookie(axios),playlistUrl=`${STREAM_URL}/pv/playlist.php?id=${id}&t=${encodeURIComponent(title)}&tm=${unix}`,res=await axios.get(playlistUrl,{headers:{"User-Agent":UA,"X-Requested-With":"XMLHttpRequest",Referer:`${STREAM_URL}/home`,Cookie:`t_hash_t=${tHashT}; ott=pv; hd=on`}}),streamLinks=[];return Array.isArray(res.data)&&res.data.forEach(item=>{var _a,_b;null===(_a=item.tracks)||void 0===_a||_a.forEach(track=>{if("captions"!==track.kind)return;track.label,track.file}),null===(_b=item.sources)||void 0===_b||_b.forEach(src=>{const cleanFile=src.file.replace("/tv/","/"),finalUrl=`${STREAM_URL}${cleanFile}`;streamLinks.push({server:`PrimeVideo ${src.label||"Auto"}`,link:finalUrl,type:"m3u8",headers:{"User-Agent":UA,Referer:`${STREAM_URL}/`,Cookie:"hd=on"}})})}),streamLinks}catch(err){return[]}};exports.getStream=getStream;